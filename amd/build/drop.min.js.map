{"version":3,"file":"drop.min.js","sources":["../src/drop.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop module.\n *\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport base from 'block_stash/baseclass';\nimport Ajax from 'core/ajax';\nimport Log from 'core/log';\nimport Item from 'block_stash/item';\nimport UserItem from 'block_stash/user-item';\nimport * as PubSub from 'core/pubsub';\n\nexport default class drop extends base {\n\n    constructor(dropdata, item) {\n        super(dropdata);\n        this.item = item;\n    }\n\n    getItem() {\n        return this.item;\n    }\n\n    isVisible() {\n        return Ajax.call([{\n            methodname: 'block_stash_is_drop_visible',\n            args: {\n                dropid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].then(function(visible) {\n            if (!visible) {\n                return Promise.reject();\n            }\n            return true;\n        });\n    }\n\n    pickup() {\n        return Ajax.call([{\n            methodname: 'block_stash_pickup_drop',\n            args: {\n                dropid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].fail(function() {\n            Log.debug('The item could not be picked up.');\n\n        }).then(function(data) {\n            // Do not change this._item as it's not a predictable behaviour.\n            var userItem = new UserItem(data.useritem, new Item(data.item));\n            PubSub.publish('block_stash/drop/pickedup', {\n                id: this.get('id'),\n                hashcode: this.get('hashcode'),\n                useritem: userItem\n            });\n        }.bind(this));\n    }\n\n}\n"],"names":["_interopRequireDefault","e","__esModule","default","_baseclass","_ajax","_log","_item","_userItem","PubSub","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_interopRequireWildcard","drop","base","constructor","dropdata","item","super","this","getItem","isVisible","Ajax","methodname","args","dropid","hashcode","then","visible","Promise","reject","pickup","fail","Log","debug","data","userItem","UserItem","useritem","Item","publish","id","bind","_exports"],"mappings":"8MA2BsC,SAAAA,uBAAAC,UAAAA,GAAAA,EAAAC,WAAAD,GAAAE,QAAAF;;;;;;qFALtCG,WAAAJ,uBAAAI,YACAC,MAAAL,uBAAAK,OACAC,KAAAN,uBAAAM,MACAC,MAAAP,uBAAAO,OACAC,UAAAR,uBAAAQ,WACAC,OAAsC,SAAAR,EAAAS,yBAAAC,YAAAC,MAAAD,QAAAE,MAAAF,wBAAAV,EAAAS,OAAAA,GAAAT,GAAAA,EAAAC,kBAAAD,MAAAa,EAAAC,EAAAC,GAAAC,eAAAd,QAAAF,aAAAA,oBAAAA,sBAAAA,SAAAe,KAAAF,EAAAJ,EAAAG,EAAAD,MAAAE,EAAAI,IAAAjB,UAAAa,EAAAK,IAAAlB,GAAAa,EAAAM,IAAAnB,EAAAe,aAAAN,KAAAT,cAAAS,MAAAW,eAAAC,KAAArB,EAAAS,MAAAK,GAAAD,EAAAS,OAAAC,iBAAAD,OAAAE,yBAAAxB,EAAAS,MAAAK,EAAAI,KAAAJ,EAAAK,KAAAN,EAAAE,EAAAN,EAAAK,GAAAC,EAAAN,GAAAT,EAAAS,WAAAM,GAAAf,EAAAS,GAAtCgB,CAAAjB,QAEe,MAAMkB,aAAaC,mBAE9BC,WAAAA,CAAYC,SAAUC,MAClBC,MAAMF,UACNG,KAAKF,KAAOA,KAGhBG,OAAAA,GACI,OAAOD,KAAKF,KAGhBI,SAAAA,GACI,OAAOC,cAAKd,KAAK,CAAC,CACde,WAAY,8BACZC,KAAM,CACFC,OAAQN,KAAKd,IAAI,MACjBqB,SAAUP,KAAKd,IAAI,gBAEvB,GAAGsB,KAAK,SAASC,SACjB,QAAKA,SACMC,QAAQC,WAM3BC,MAAAA,GACI,OAAOT,cAAKd,KAAK,CAAC,CACde,WAAY,0BACZC,KAAM,CACFC,OAAQN,KAAKd,IAAI,MACjBqB,SAAUP,KAAKd,IAAI,gBAEvB,GAAG2B,KAAK,WACRC,aAAIC,MAAM,sCAEXP,KAAK,SAASQ,MAEb,IAAIC,SAAW,IAAIC,kBAASF,KAAKG,SAAU,IAAIC,cAAKJ,KAAKlB,OACzDtB,OAAO6C,QAAQ,4BAA6B,CACxCC,GAAItB,KAAKd,IAAI,MACbqB,SAAUP,KAAKd,IAAI,YACnBiC,SAAUF,YAEhBM,KAAKvB,QAGd,OAAAwB,SAAAtD,QAAAwB,KAAA8B,SAAAtD,OAAA"}