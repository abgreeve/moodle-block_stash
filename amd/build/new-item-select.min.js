define("block_stash/new-item-select",["exports","core/pending","core/templates","core_grades/searchwidget/basewidget","jquery","core/ajax"],function(_exports,_pending,Templates,WidgetBase,_jquery,_ajax){function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(_interopRequireWildcard=function(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=typeof e&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(const t in e)"default"!==t&&{}.hasOwnProperty.call(e,t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,t))&&(i.get||i.set)?o(f,t,i):f[t]=e[t]);return f})(e,t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}
/**
   * A small modal to search grade items within the gradebook.
   *
   * @copyright 2023 Adrian Greeve <abgreeve@gmail.com>
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_pending=_interopRequireDefault(_pending),Templates=_interopRequireWildcard(Templates),WidgetBase=_interopRequireWildcard(WidgetBase),_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);_exports.init=()=>{const pendingPromise=new _pending.default;registerListenerEvents(),pendingPromise.resolve()};const registerListenerEvents=()=>{let{bodyPromiseResolver:bodyPromiseResolver,bodyPromise:bodyPromise}=WidgetBase.promisesAndResolvers(),dropdownselector='.search-widget[data-searchtype="block_stash-item"]';const dropdownMenuContainer=document.querySelector('.search-widget[data-searchtype="block_stash-item"] .dropdown-menu');(0,_jquery.default)(dropdownselector).on("show.bs.dropdown",async e=>{const courseID=e.relatedTarget.dataset.courseid;await WidgetBase.showLoader(dropdownMenuContainer);const data=await swapitemFetch(courseID).catch(async e=>{const errorTemplateData={errormessage:e.message};bodyPromiseResolver(await Templates.render("core_grades/searchwidget/error",errorTemplateData))});data!==[]&&(await WidgetBase.init(dropdownMenuContainer,bodyPromise,data.items,searchGradeitems()),bodyPromiseResolver(Templates.render("block_stash/itemsearch_body",[])))}),(0,_jquery.default)(dropdownselector).on("hide.bs.dropdown",()=>{dropdownMenuContainer.innerHTML=""})},swapitemFetch=courseid=>{const request={methodname:"block_stash_get_swap_items_for_search_widget",args:{courseid:courseid}};return _ajax.default.call([request])[0]},searchGradeitems=()=>()=>(modules,searchTerm)=>{if(""===searchTerm)return modules;searchTerm=searchTerm.toLowerCase();const searchResults=[];return modules.forEach(module=>{module.name.toLowerCase().includes(searchTerm)&&searchResults.push(module)}),searchResults}});

//# sourceMappingURL=new-item-select.min.js.map