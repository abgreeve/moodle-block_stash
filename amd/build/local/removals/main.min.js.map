{"version":3,"file":"main.min.js","sources":["../../../src/local/removals/main.js"],"sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport * as tradeAdder from 'block_stash/local/trade_adder/main';\nimport Ajax from 'core/ajax';\n\nconst showModal = async(courseid) => {\n    const modal = await buildModal(courseid);\n    displayModal(modal, courseid);\n};\n\nconst buildModal = async(courseid) => {\n\n    // Fetch quizzes.\n    let quizzes = await fetchItemData(courseid);\n\n    // let items = await Item.getItem(itemId);\n    // let context = items.getData();\n    let context = {'courseid': courseid, 'quizzes': quizzes.activities};\n\n    return ModalFactory.create({\n        title: context.name,\n        body: Templates.render('block_stash/local/removal/removal_form', context),\n        type: ModalFactory.types.SAVE_CANCEL\n    });\n};\n\nconst displayModal = async(modal, courseid) => {\n\n    modal.getRoot().on(ModalEvents.bodyRendered, () => {\n        tradeAdder.init();\n    });\n\n    modal.getRoot().on(ModalEvents.save, () => {\n        // window.console.log('get the form data, and save');\n        let itemsinfo = document.querySelectorAll('.block-stash-quantity');\n        // window.console.log(itemsinfo);\n        let items = [];\n        itemsinfo.forEach((item) => {\n            // window.console.log(item);\n            let itemid = item.closest('.block-stash-trade-item').getAttribute('data-id');\n            items.push({\n                'itemid': parseInt(itemid),\n                'quantity': parseInt(item.value)\n            });\n        });\n        window.console.log(items);\n        // Quiz data\n        let quizinfo = document.querySelector('.block-stash-quiz-select').value;\n        window.console.log(quizinfo);\n        // Now send off to be saved.\n        saveRemovalEntry(courseid, parseInt(quizinfo), items);\n    });\n\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n    modal.show();\n};\n\nexport const init = (courseid) => {\n\n    let configbutton = document.querySelector('.block-config-removal');\n    configbutton.addEventListener('click', (e) => {\n        e.preventDefault();\n        showModal(courseid);\n    });\n};\n\nconst fetchItemData = (courseid) => Ajax.call([{\n    methodname: 'block_stash_get_removal_activities',\n    args: {courseid: courseid}\n}])[0];\n\nconst saveRemovalEntry = (courseid, cmid, items) => Ajax.call([{\n    methodname: 'block_stash_save_removal',\n    args: {'courseid': courseid, 'cmid': cmid, 'items': items}\n}])[0];\n"],"names":["buildModal","async","context","courseid","fetchItemData","activities","ModalFactory","create","title","name","body","Templates","render","type","types","SAVE_CANCEL","displayModal","modal","getRoot","on","ModalEvents","bodyRendered","tradeAdder","init","save","itemsinfo","document","querySelectorAll","items","forEach","item","itemid","closest","getAttribute","push","parseInt","value","window","console","log","quizinfo","querySelector","saveRemovalEntry","hidden","destroy","show","addEventListener","e","preventDefault","showModal","Ajax","call","methodname","args","cmid"],"mappings":"qgDAWMA,WAAaC,MAAAA,eAOXC,QAAU,UAAaC,wBAJPC,cAAcD,WAIsBE,mBAEjDC,uBAAaC,OAAO,CACvBC,MAAON,QAAQO,KACfC,KAAMC,mBAAUC,OAAO,yCAA0CV,SACjEW,KAAMP,uBAAaQ,MAAMC,eAI3BC,aAAef,MAAMgB,MAAOd,YAE9Bc,MAAMC,UAAUC,GAAGC,sBAAYC,cAAc,KACzCC,WAAWC,UAGfN,MAAMC,UAAUC,GAAGC,sBAAYI,MAAM,SAE7BC,UAAYC,SAASC,iBAAiB,yBAEtCC,MAAQ,GACZH,UAAUI,SAASC,WAEXC,OAASD,KAAKE,QAAQ,2BAA2BC,aAAa,WAClEL,MAAMM,KAAK,QACGC,SAASJ,iBACPI,SAASL,KAAKM,YAGlCC,OAAOC,QAAQC,IAAIX,WAEfY,SAAWd,SAASe,cAAc,4BAA4BL,MAClEC,OAAOC,QAAQC,IAAIC,UAEnBE,iBAAiBvC,SAAUgC,SAASK,UAAWZ,UAGnDX,MAAMC,UAAUC,GAAGC,sBAAYuB,QAAQ,KACnC1B,MAAM2B,aAEV3B,MAAM4B,sBAGW1C,WAEEuB,SAASe,cAAc,yBAC7BK,iBAAiB,SAAUC,IACpCA,EAAEC,iBA1DQ/C,OAAAA,iBACRgB,YAAcjB,WAAWG,UAC/Ba,aAAaC,MAAOd,WAyDhB8C,CAAU9C,oBAIZC,cAAiBD,UAAa+C,cAAKC,KAAK,CAAC,CAC3CC,WAAY,qCACZC,KAAM,CAAClD,SAAUA,aACjB,GAEEuC,iBAAmB,CAACvC,SAAUmD,KAAM1B,QAAUsB,cAAKC,KAAK,CAAC,CAC3DC,WAAY,2BACZC,KAAM,UAAalD,cAAkBmD,WAAe1B,UACpD"}