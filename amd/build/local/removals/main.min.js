define("block_stash/local/removals/main",["exports","core/modal_factory","core/modal_events","core/templates","block_stash/local/trade_adder/main","core/ajax"],(function(_exports,_modal_factory,_modal_events,_templates,tradeAdder,_ajax){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates),tradeAdder=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(tradeAdder),_ajax=_interopRequireDefault(_ajax);const buildModal=async courseid=>{let context={courseid:courseid,quizzes:(await fetchItemData(courseid)).activities};return _modal_factory.default.create({title:context.name,body:_templates.default.render("block_stash/local/removal/removal_form",context),type:_modal_factory.default.types.SAVE_CANCEL})},displayModal=async(modal,courseid)=>{modal.getRoot().on(_modal_events.default.bodyRendered,(()=>{tradeAdder.init()})),modal.getRoot().on(_modal_events.default.save,(()=>{let itemsinfo=document.querySelectorAll(".block-stash-quantity"),items=[];itemsinfo.forEach((item=>{let itemid=item.closest(".block-stash-trade-item").getAttribute("data-id");items.push({itemid:parseInt(itemid),quantity:parseInt(item.value)})})),window.console.log(items);let quizinfo=document.querySelector(".block-stash-quiz-select").value;window.console.log(quizinfo),saveRemovalEntry(courseid,parseInt(quizinfo),items)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()};_exports.init=courseid=>{document.querySelector(".block-config-removal").addEventListener("click",(e=>{e.preventDefault(),(async courseid=>{const modal=await buildModal(courseid);displayModal(modal,courseid)})(courseid)}))};const fetchItemData=courseid=>_ajax.default.call([{methodname:"block_stash_get_removal_activities",args:{courseid:courseid}}])[0],saveRemovalEntry=(courseid,cmid,items)=>_ajax.default.call([{methodname:"block_stash_save_removal",args:{courseid:courseid,cmid:cmid,items:items}}])[0]}));

//# sourceMappingURL=main.min.js.map