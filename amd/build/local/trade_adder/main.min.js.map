{"version":3,"file":"main.min.js","sources":["../../../src/local/trade_adder/main.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nexport const init = async () => {\n    // Fetch items to populate the select box.\n    let maindiv = document.querySelector('.block-stash-item-adder');\n    let courseid = maindiv.dataset.courseId;\n    let itemdata = await fetchItemData(courseid);\n\n    // populate the list\n    let listnode = maindiv.querySelector('.dropdown-list ul');\n\n    for (let item of itemdata.items) {\n        // window.console.log(item);\n        let listitem = document.createElement('li');\n        listitem.innerHTML = item.name;\n        listitem.dataset.itemid = item.id;\n        listitem.dataset.imgurl = item.imageurl;\n        listitem.addEventListener('click', addItemToTable);\n        listnode.appendChild(listitem);\n    }\n\n    // window.console.log(listnode);\n    // window.console.log(itemdata);\n\n    let selector = document.querySelector('.item-adder-add');\n    selector.addEventListener('click', (e) => {\n        let currentbutton = e.currentTarget;\n        let dropdownlist = currentbutton.parentNode.querySelector('.dropdown-list');\n        dropdownlist.style.display = (dropdownlist.style.display == 'none') ? 'block' : 'none';\n    });\n\n    document.addEventListener('mouseup', (e) => {\n        let dropdowncontainer = document.querySelector('.dropdown-container');\n        let currentelement = e.target;\n        let dropdownlist = dropdowncontainer.querySelector('.dropdown-list');\n        if (!dropdowncontainer.contains(currentelement)) {\n            dropdownlist.style.display = 'none';\n        }\n    });\n};\n\nconst addItemToTable = (e) => {\n    let itemnode = e.currentTarget;\n    let data = {\n        itemid: itemnode.dataset.itemid,\n        imageurl: itemnode.dataset.imgurl,\n        name: itemnode.innerText,\n        quantity: 1\n    };\n\n    let type = 'gain';\n\n    let templatename = (type === 'gain') ? 'block_stash/trade_add_item_detail' : 'block_stash/trade_loss_item_detail';\n    Templates.render(templatename, data).done((html, js) => {\n        let itemsbox = document.querySelector('.block_stash_item_box[data-type=\"' + type + '\"]');\n        Templates.appendNodeContents(itemsbox, html, js);\n        registerActions();\n    });\n};\n\nconst registerActions = () => {\n    let deleteelements = document.getElementsByClassName('block-stash-delete-item');\n    for (let delement of deleteelements) {\n        delement.addEventListener('click', deleteItem);\n    }\n};\n\nconst deleteItem = (element) => {\n    let child = element.currentTarget;\n    let parent = child.closest('.block-stash-trade-item');\n    parent.remove();\n    element.preventDefault();\n};\n\nconst fetchItemData = (courseid) => Ajax.call([{\n    methodname: 'block_stash_get_items',\n    args: {courseid: courseid}\n}])[0];\n"],"names":["async","maindiv","document","querySelector","courseid","dataset","courseId","itemdata","fetchItemData","listnode","item","items","listitem","createElement","innerHTML","name","itemid","id","imgurl","imageurl","addEventListener","addItemToTable","appendChild","e","dropdownlist","currentTarget","parentNode","style","display","dropdowncontainer","currentelement","target","contains","itemnode","data","innerText","quantity","render","done","html","js","itemsbox","appendNodeContents","registerActions","deleteelements","getElementsByClassName","delement","deleteItem","element","closest","remove","preventDefault","Ajax","call","methodname","args"],"mappings":"yXAGoBA,cAEZC,QAAUC,SAASC,cAAc,2BACjCC,SAAWH,QAAQI,QAAQC,SAC3BC,eAAiBC,cAAcJ,UAG/BK,SAAWR,QAAQE,cAAc,yBAEhC,IAAIO,QAAQH,SAASI,MAAO,KAEzBC,SAAWV,SAASW,cAAc,MACtCD,SAASE,UAAYJ,KAAKK,KAC1BH,SAASP,QAAQW,OAASN,KAAKO,GAC/BL,SAASP,QAAQa,OAASR,KAAKS,SAC/BP,SAASQ,iBAAiB,QAASC,gBACnCZ,SAASa,YAAYV,UAMVV,SAASC,cAAc,mBAC7BiB,iBAAiB,SAAUG,QAE5BC,aADgBD,EAAEE,cACWC,WAAWvB,cAAc,kBAC1DqB,aAAaG,MAAMC,QAAyC,QAA9BJ,aAAaG,MAAMC,QAAqB,QAAU,UAGpF1B,SAASkB,iBAAiB,WAAYG,QAC9BM,kBAAoB3B,SAASC,cAAc,uBAC3C2B,eAAiBP,EAAEQ,OACnBP,aAAeK,kBAAkB1B,cAAc,kBAC9C0B,kBAAkBG,SAASF,kBAC5BN,aAAaG,MAAMC,QAAU,kBAKnCP,eAAkBE,QAChBU,SAAWV,EAAEE,cACbS,KAAO,CACPlB,OAAQiB,SAAS5B,QAAQW,OACzBG,SAAUc,SAAS5B,QAAQa,OAC3BH,KAAMkB,SAASE,UACfC,SAAU,sBAMJC,OAD6B,oCACRH,MAAMI,MAAK,CAACC,KAAMC,UACzCC,SAAWvC,SAASC,cAAc,8DAC5BuC,mBAAmBD,SAAUF,KAAMC,IAC7CG,sBAIFA,gBAAkB,SAChBC,eAAiB1C,SAAS2C,uBAAuB,+BAChD,IAAIC,YAAYF,eACjBE,SAAS1B,iBAAiB,QAAS2B,aAIrCA,WAAcC,UACJA,QAAQvB,cACDwB,QAAQ,2BACpBC,SACPF,QAAQG,kBAGN3C,cAAiBJ,UAAagD,cAAKC,KAAK,CAAC,CAC3CC,WAAY,wBACZC,KAAM,CAACnD,SAAUA,aACjB"}