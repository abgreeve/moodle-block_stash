{"version":3,"file":"settings.min.js","sources":["../../../src/local/leaderboard/settings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Leaderboard settings JavaScript\n *\n * @copyright 2023 Adrian Greeve <adriangreeve.com>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {add as addToast} from 'core/toast';\nimport Ajax from 'core/ajax';\n\nexport const init = () => {\n    // window.console.log('hi from settings');\n    let temp = document.querySelector('.block-stash-lbsetting');\n    temp.addEventListener('change', (e) => {\n\n        let currenttarget = e.currentTarget;\n        updateSetting(currenttarget.dataset.courseid, 'leaderboard', currenttarget.checked).then((result) => {\n            if (result) {\n                addToast('Setting updated', { // GetString!\n                    type: 'info',\n                    autohide: true,\n                    closeButton: true,\n                });\n            }\n        });\n    });\n\n    let lbgroupswitch = document.querySelector('.block-stash-lbgroups');\n    lbgroupswitch.addEventListener('change', (e) => {\n        let currenttarget = e.currentTarget;\n        updateSetting(currenttarget.dataset.courseid, 'leaderboard_groups', currenttarget.checked).then((result) => {\n            if (result) {\n                addToast('Setting updated', { // GetString!\n                    type: 'info',\n                    autohide: true,\n                    closeButton: true,\n                });\n            }\n        });\n    });\n\n    let otherboards = document.querySelectorAll('.block_stash-leaderboard');\n    otherboards.forEach((board) => {\n        board.addEventListener('change', (e) => {\n            let otherboardelement = e.currentTarget;\n            let enabled = otherboardelement.checked;\n            updateLeaderboard(otherboardelement.dataset.courseid, otherboardelement.dataset.location, '', 'DESC', 5, enabled)\n            .then((result) => {\n                if (result) {\n                    addToast('Setting updated', { // GetString!\n                        type: 'info',\n                        autohide: true,\n                        closeButton: true,\n                    });\n                }\n            });\n        });\n    });\n};\n\nconst updateSetting = (courseid, key, value) => {\n    return Ajax.call([{\n        methodname: 'block_stash_leaderboard_settings',\n        args: {\n            courseid: courseid,\n            key: key,\n            value: value\n        }\n    }])[0];\n};\n\nconst updateLeaderboard = (courseid, title, options, sortorder, limit, enabled) => {\n    return Ajax.call([{\n        methodname: 'block_stash_leaderboard_update',\n        args: {\n            courseid: courseid,\n            boardname: title,\n            options: options,\n            sortorder: sortorder,\n            rowlimit: limit,\n            enabled: enabled\n        }\n    }])[0];\n};\n"],"names":["document","querySelector","addEventListener","e","currenttarget","currentTarget","updateSetting","dataset","courseid","checked","then","result","type","autohide","closeButton","querySelectorAll","forEach","board","otherboardelement","enabled","updateLeaderboard","location","key","value","Ajax","call","methodname","args","title","options","sortorder","limit","boardname","rowlimit"],"mappings":";;;;;;oJAyBoB,KAELA,SAASC,cAAc,0BAC7BC,iBAAiB,UAAWC,QAEzBC,cAAgBD,EAAEE,cACtBC,cAAcF,cAAcG,QAAQC,SAAU,cAAeJ,cAAcK,SAASC,MAAMC,SAClFA,uBACS,kBAAmB,CACxBC,KAAM,OACNC,UAAU,EACVC,aAAa,UAMTd,SAASC,cAAc,yBAC7BC,iBAAiB,UAAWC,QAClCC,cAAgBD,EAAEE,cACtBC,cAAcF,cAAcG,QAAQC,SAAU,qBAAsBJ,cAAcK,SAASC,MAAMC,SACzFA,uBACS,kBAAmB,CACxBC,KAAM,OACNC,UAAU,EACVC,aAAa,UAMXd,SAASe,iBAAiB,4BAChCC,SAASC,QACjBA,MAAMf,iBAAiB,UAAWC,QAC1Be,kBAAoBf,EAAEE,cACtBc,QAAUD,kBAAkBT,QAChCW,kBAAkBF,kBAAkBX,QAAQC,SAAUU,kBAAkBX,QAAQc,SAAU,GAAI,OAAQ,EAAGF,SACxGT,MAAMC,SACCA,uBACS,kBAAmB,CACxBC,KAAM,OACNC,UAAU,EACVC,aAAa,oBAQ/BR,cAAgB,CAACE,SAAUc,IAAKC,QAC3BC,cAAKC,KAAK,CAAC,CACdC,WAAY,mCACZC,KAAM,CACFnB,SAAUA,SACVc,IAAKA,IACLC,MAAOA,UAEX,GAGFH,kBAAoB,CAACZ,SAAUoB,MAAOC,QAASC,UAAWC,MAAOZ,UAC5DK,cAAKC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACFnB,SAAUA,SACVwB,UAAWJ,MACXC,QAASA,QACTC,UAAWA,UACXG,SAAUF,MACVZ,QAASA,YAEb"}