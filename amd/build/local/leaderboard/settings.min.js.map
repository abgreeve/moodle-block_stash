{"version":3,"file":"settings.min.js","sources":["../../../src/local/leaderboard/settings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Leaderboard settings JavaScript\n *\n * @copyright 2023 Adrian Greeve <adriangreeve.com>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {add as addToast} from 'core/toast';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\n\nexport const init = () => {\n    // window.console.log('hi from settings');\n    let temp = document.querySelector('.block-stash-lbsetting');\n    temp.addEventListener('change', (e) => {\n\n        let currenttarget = e.currentTarget;\n        updateSetting(currenttarget.dataset.courseid, 'leaderboard', currenttarget.checked).then((result) => {\n            if (result) {\n                addToast(getString('settingupdated', 'block_stash'), {\n                    type: 'info',\n                    autohide: true,\n                    closeButton: true,\n                });\n            }\n        });\n    });\n\n    let lbgroupswitch = document.querySelector('.block-stash-lbgroups');\n    lbgroupswitch.addEventListener('change', (e) => {\n        let currenttarget = e.currentTarget;\n        updateSetting(currenttarget.dataset.courseid, 'leaderboard_groups', currenttarget.checked).then((result) => {\n            if (result) {\n                addToast(getString('settingupdated', 'block_stash'), {\n                    type: 'info',\n                    autohide: true,\n                    closeButton: true,\n                });\n            }\n        });\n    });\n\n    let otherboards = document.querySelectorAll('.block_stash-leaderboard');\n    otherboards.forEach((board) => {\n        board.addEventListener('change', (e) => {\n            let otherboardelement = e.currentTarget;\n            let enabled = otherboardelement.checked;\n\n            let tmep = otherboardelement.parentNode.parentNode.querySelector('.block_stash-leaderboard-limit');\n            if (!enabled) {\n                tmep.setAttribute('disabled', true);\n            } else {\n                tmep.removeAttribute('disabled');\n            }\n\n            updateLeaderboard(otherboardelement.dataset.courseid, otherboardelement.dataset.location, '', 'DESC', tmep.value,\n                    enabled)\n            .then((result) => {\n                if (result) {\n                    addToast(getString('settingupdated', 'block_stash'), {\n                        type: 'info',\n                        autohide: true,\n                        closeButton: true,\n                    });\n                }\n            });\n        });\n    });\n\n    let rowlimits = document.querySelectorAll('.block_stash-leaderboard-limit');\n    rowlimits.forEach((limit) => {\n        limit.addEventListener('change', (e) => {\n            let currenttarget = e.currentTarget;\n            let rowlimit = currenttarget.value;\n            let otherthing = currenttarget.parentNode.parentNode.parentNode.querySelector('.block_stash-leaderboard');\n            window.console.log(otherthing);\n            window.console.log(rowlimit);\n            updateLeaderboard(otherthing.dataset.courseid, otherthing.dataset.location, '', 'DESC', rowlimit, true)\n            .then((result) => {\n                if (result) {\n                    addToast(getString('settingupdated', 'block_stash'), {\n                        type: 'info',\n                        autohide: true,\n                        closeButton: true,\n                    });\n                }\n            });\n        });\n    });\n};\n\nconst updateSetting = (courseid, key, value) => {\n    return Ajax.call([{\n        methodname: 'block_stash_leaderboard_settings',\n        args: {\n            courseid: courseid,\n            key: key,\n            value: value\n        }\n    }])[0];\n};\n\nconst updateLeaderboard = (courseid, title, options, sortorder, limit, enabled) => {\n    return Ajax.call([{\n        methodname: 'block_stash_leaderboard_update',\n        args: {\n            courseid: courseid,\n            boardname: title,\n            options: options,\n            sortorder: sortorder,\n            rowlimit: limit,\n            enabled: enabled\n        }\n    }])[0];\n};\n"],"names":["document","querySelector","addEventListener","e","currenttarget","currentTarget","updateSetting","dataset","courseid","checked","then","result","type","autohide","closeButton","querySelectorAll","forEach","board","otherboardelement","enabled","tmep","parentNode","removeAttribute","setAttribute","updateLeaderboard","location","value","limit","rowlimit","otherthing","window","console","log","key","Ajax","call","methodname","args","title","options","sortorder","boardname"],"mappings":";;;;;;oJA0BoB,KAELA,SAASC,cAAc,0BAC7BC,iBAAiB,UAAWC,QAEzBC,cAAgBD,EAAEE,cACtBC,cAAcF,cAAcG,QAAQC,SAAU,cAAeJ,cAAcK,SAASC,MAAMC,SAClFA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,UAMTd,SAASC,cAAc,yBAC7BC,iBAAiB,UAAWC,QAClCC,cAAgBD,EAAEE,cACtBC,cAAcF,cAAcG,QAAQC,SAAU,qBAAsBJ,cAAcK,SAASC,MAAMC,SACzFA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,UAMXd,SAASe,iBAAiB,4BAChCC,SAASC,QACjBA,MAAMf,iBAAiB,UAAWC,QAC1Be,kBAAoBf,EAAEE,cACtBc,QAAUD,kBAAkBT,QAE5BW,KAAOF,kBAAkBG,WAAWA,WAAWpB,cAAc,kCAC5DkB,QAGDC,KAAKE,gBAAgB,YAFrBF,KAAKG,aAAa,YAAY,GAKlCC,kBAAkBN,kBAAkBX,QAAQC,SAAUU,kBAAkBX,QAAQkB,SAAU,GAAI,OAAQL,KAAKM,MACnGP,SACPT,MAAMC,SACCA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,aAOjBd,SAASe,iBAAiB,kCAChCC,SAASW,QACfA,MAAMzB,iBAAiB,UAAWC,QAC1BC,cAAgBD,EAAEE,cAClBuB,SAAWxB,cAAcsB,MACzBG,WAAazB,cAAciB,WAAWA,WAAWA,WAAWpB,cAAc,4BAC9E6B,OAAOC,QAAQC,IAAIH,YACnBC,OAAOC,QAAQC,IAAIJ,UACnBJ,kBAAkBK,WAAWtB,QAAQC,SAAUqB,WAAWtB,QAAQkB,SAAU,GAAI,OAAQG,UAAU,GACjGlB,MAAMC,SACCA,wBACS,mBAAU,iBAAkB,eAAgB,CACjDC,KAAM,OACNC,UAAU,EACVC,aAAa,oBAQ/BR,cAAgB,CAACE,SAAUyB,IAAKP,QAC3BQ,cAAKC,KAAK,CAAC,CACdC,WAAY,mCACZC,KAAM,CACF7B,SAAUA,SACVyB,IAAKA,IACLP,MAAOA,UAEX,GAGFF,kBAAoB,CAAChB,SAAU8B,MAAOC,QAASC,UAAWb,MAAOR,UAC5De,cAAKC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACF7B,SAAUA,SACViC,UAAWH,MACXC,QAASA,QACTC,UAAWA,UACXZ,SAAUD,MACVR,QAASA,YAEb"}