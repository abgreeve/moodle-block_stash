{"version":3,"file":"drop-snippet-maker.min.js","sources":["../src/drop-snippet-maker.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop snippet maker module.\n *\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n], function($) {\n\n    /**\n     * Drop snippet maker class.\n     *\n     * @param {Drop} drop The drop.\n     */\n    function Maker(drop) {\n        this._drop = drop;\n    }\n\n    Maker.prototype.IMAGE = 'image';\n    Maker.prototype.IMAGEANDBUTTON = 'imageandbutton';\n    Maker.prototype.TEXT = 'text';\n\n    Maker.prototype._actionText = null;\n    Maker.prototype._displayType = Maker.prototype.IMAGEANDBUTTON;\n    Maker.prototype._label = null;\n\n    /**\n     * Get the action text.\n     *\n     * @return {String}\n     */\n    Maker.prototype._getActionText = function() {\n        if (this._actionText === null || this._actionText.trim() === '') {\n            return this.getDefaultActionText();\n        }\n        return this._actionText;\n    };\n\n    /**\n     * Get the anchor.\n     *\n     * @return {Node}\n     */\n    Maker.prototype._getAnchor = function() {\n        return $('<a href=\"#\"></a>');\n    };\n\n    /**\n     * Get the default action text.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getDefaultActionText = function() {\n        return 'Pick up!';\n    };\n\n    /**\n     * Get the default label.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getDefaultLabel = function() {\n        return \"Pick up '\" + this.getItem().get('name') + \"'\";\n    };\n\n    /**\n     * Get the button.\n     *\n     * @return {Node}\n     */\n    Maker.prototype._getDisplayButton = function() {\n        var wrap = $('<div class=\"item-action\"></div>'),\n            btn = $('<button class=\"btn btn-secondary\"></button>');\n\n        btn.text(this._getActionText());\n        wrap.append(btn);\n\n        return wrap;\n    };\n\n    /**\n     * Get the image.\n     *\n     * @return {Node}\n     */\n\n    Maker.prototype._getDisplayImage = function() {\n        var img = $('<div class=\"item-image\"></div>'),\n            label = $('<div class=\"item-label\"></div>');\n\n        img.addClass('item-image');\n        img.css('backgroundImage', 'url(' + this.getItem().get('imageurl') + ')');\n        label.text(this.getItem().get('name'));\n        label.attr('title', this.getItem().get('name'));\n        img.append(label);\n\n        return img;\n    };\n\n    /**\n     * Get the drop.\n     *\n     * @return {Drop}\n     */\n    Maker.prototype.getDrop = function() {\n        return this._drop;\n    };\n\n    /**\n     * Get the whole display.\n     *\n     * @return {Node}\n     */\n    Maker.prototype.getDisplay = function() {\n        return this._getDisplayType(this._displayType);\n    };\n\n    /**\n     * Get the display by type.\n     *\n     * @param {String} displaytype The display type.\n     * @return {Drop}\n     */\n    Maker.prototype._getDisplayType = function(displaytype) {\n        var display,\n            anchor;\n\n        if (displaytype == this.IMAGE) {\n            display = $('<div class=\"block-stash-item\"></div>');\n            window.console.log(display);\n            window.console.log('display');\n            anchor = this._getAnchor();\n            anchor.append(this._getDisplayImage());\n            display.append(anchor);\n\n        } else if (displaytype == this.IMAGEANDBUTTON) {\n            display = $('<div class=\"block-stash-item\"></div>');\n            window.console.log(display);\n            window.console.log('display');\n            display.append(this._getDisplayImage());\n            display.append(this._getDisplayButton());\n\n        } else {\n            display = $('<span></span>');\n            window.console.log(display);\n            window.console.log('display');\n            anchor = this._getAnchor();\n            anchor.text(this._getLabel());\n            display.append(anchor);\n        }\n\n        return display;\n    };\n\n    /**\n     * Get the drop item.\n     *\n     * @return {Item}\n     */\n    Maker.prototype.getItem = function() {\n        return this._drop.getItem();\n    };\n\n    /**\n     * Get the label.\n     *\n     * @return {String}\n     */\n    Maker.prototype._getLabel = function() {\n        if (this._label === null || this._label.trim() === '') {\n            return this.getDefaultLabel();\n        }\n        return this._label;\n    };\n\n    /**\n     * Get the snippet.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getSnippet = function() {\n        var node = $('<div>'),\n            uuid = this.uuid(),\n            wrapper = $('<span id=\"' + uuid + '\">'),\n            script = $('<script type=\"text/javascript\">'),\n            id = this.getDrop().get('id'),\n            hashcode = this.getDrop().get('hashcode'),\n            display = this.getDisplay(),\n            snippet = '';\n\n        // No need to scope this in an anonymous function, it already is because of require.\n        // WARNING! Changing this structure could break restores!\n        snippet = '' +\n            'require([\"jquery\", \"block_stash/drop\"], function($, D) {' +\n            ' var d = new D({id: ' + id + ', hashcode: \"' + hashcode + '\"}), n = $(\"#' + uuid + '\");' +\n            ' if (!n.length) return; n.removeClass(); d.isVisible().then(function() { n.show(); });' +\n            ' n.find(\"a, button\").click(function(e) { e.preventDefault(); d.pickup(); n.remove(); });' +\n            '})';\n        snippet = this._wrapForOnReady(snippet);\n\n        node.append(wrapper);\n        wrapper.css('display', 'none');\n        wrapper.append(display);\n        wrapper.append(script);\n        script.html(snippet);\n\n        return node.html();\n    };\n\n    /**\n     * Set the display type.\n     *\n     * @param {String} v The display type.\n     */\n    Maker.prototype.setDisplayType = function(v) {\n        this._displayType = v;\n    };\n\n    /**\n     * Set the action text.\n     *\n     * @param {String} v The action text.\n     */\n    Maker.prototype.setActionText = function(v) {\n        this._actionText = v;\n    };\n\n    /**\n     * Set the label.\n     *\n     * @param {String} v The label.\n     */\n    Maker.prototype.setLabel = function(v) {\n        this._label = v;\n    };\n\n    /**\n     * Get a unique ID.\n     *\n     * @return {String}\n     */\n    Maker.prototype.uuid = function() {\n        return (Math.random().toString(36).substring(2, 7)) + (((new Date()).getTime()).toString(36));\n    };\n\n    /**\n     * Wrap some script in a function waiting for the document to be ready.\n     *\n     * @param {String} code The script.\n     * @return {String} The new script.\n     */\n    Maker.prototype._wrapForOnReady = function(code) {\n        return 'document.addEventListener(\"DOMContentLoaded\", function(e) {' + code + '});';\n    };\n\n    return /** @alias module:block_stash/drop-snippet-maker */ Maker;\n\n});\n"],"names":["define","$","Maker","drop","this","_drop","prototype","IMAGE","IMAGEANDBUTTON","TEXT","_actionText","_displayType","_label","_getActionText","trim","getDefaultActionText","_getAnchor","getDefaultLabel","getItem","get","_getDisplayButton","wrap","btn","text","append","_getDisplayImage","img","label","addClass","css","attr","getDrop","getDisplay","_getDisplayType","displaytype","display","anchor","window","console","log","_getLabel","getSnippet","node","uuid","wrapper","script","id","hashcode","snippet","_wrapForOnReady","html","setDisplayType","v","setActionText","setLabel","Math","random","toString","substring","Date","getTime","code"],"mappings":"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"}